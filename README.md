# SPANDAK+
-----------------
The main scripts used in the SPANDAK+ semi-automated pipeline can be found in the SPANDAK+ directory.

![Flow Graph](spandak+.png)

The SPANDAK+ is comprised of two components:

## [[1] Extract2cdd_auto.py](./extract2cdd_auto.py)
-----------------

This first step of the pipeline requires three arguments:<br/>
[1] path to database containing .fil paths and corresponding .raw paths (currently accepts csv)<br/>
[2] path to csv for a single .fil from SPANDAK<br/>
[3] desired grade given by SPANDAK (choose 'B' or 'C')<br/>

First, raw voltages are extracted and place in directories specifying the start and end time of extraction, as well as the band across which they were extracted. This is done using the extract_blocks.py script written by Greg Hell, which can be found in the *extractor* directory. These the directories containing the extracted .raw files will be located in a directory entitled 'bursts'. Next, the raw voltages are spliced together using the splicer_raw.py script, also located in the *extractor* directory. Finally, the spliced raw files are coherently dedispersed using DSPSR and place in 'fits' directories within each the directories of each individual burst.

**Example Command** 
```
python extract2cdd_auto.py /datax/scratch/jfaber/SPANDAK_extension/database.csv /datax/scratch/jfaber/SPANDAK_extension/57991_49905_DIAG_FRB121102_0011.csv B
```

## [[2] Polfluxrm_auto.py](./polfluxrm_auto.py)
-----------------
Once step 1 is complete, the second step can be initiated. This requires two arguments:<br/>
[1] path to directory containing fits files<br/>
[2] path to directory containing calibration files for the observation<br/>

Currently, step two is only run on the data from individaul bursts—this will be generalized in the future. The fits files are first converted to and stored as both numpy arrays and pngs (in case the pulse needs to be visually verified by the user). Then using the calibration files, polarization and flux calibration are performed, followed by fitting of the rotation measure using Vishal Gajjar's script RMfit_curve.py. The RM fit results are output as a csv file '[pulse_id].calib.rmfit.csv', and the PA value (error included) is printed in the terminal.

**Example Command** 
```
python polfluxrm_auto.py /datax/scratch/jfaber/SPANDAK_extension/bursts/26.2_26.6_3.8_9/fits /datax/scratch/jfaber/SPANDAK_extension/calib_files
```
## Intensity Analysis

This branch of the pipeline is geared towards analyzing intensity data using numpy arrays that have been generated by PSRCHIVE. Utilities include:<br/>
[1] Structure-Maximizing DM Calculation (will soon be automated)<br/>
[2] Drift Rate Calculation<br/>
[2] Scattering Tail Analysis<br/>
[3] Sub-burst and Centroid Identification<br/>
[4] Instrumental Artifact Flagging<br/>
[5] Fourier Spectrogram Analysis<br/>

## Overview Paper

More on the specifics of using SPANDAK+ and Intensity Analysis, as well as new results on FRB121102 (R1) and FRB180916 (R3)—for which publications are in production—can be found in the following overview paper: https://www.overleaf.com/read/knbhpqmgxnp

The final presentation for the Breakthrough Listen BSRC 2020 Summer Internship can be found [here](./Breakthrough_Listen_Final_Presentation.pdf).

